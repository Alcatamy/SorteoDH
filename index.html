<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sorteo TOP10 IBERDROLA 2025/2026 - Versión Final Mejorada</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --color-oro: #ffd700;
            --color-fondo: #0a0e1a;
            --gradiente-panel: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            --borde-color: rgba(255,215,0,0.3);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0a0e1a 0%, #1a1f2e 100%);
            color: #ffffff;
            overflow: hidden;
        }
        .container {
            height: 100vh;
            display: grid;
            grid-template-rows: auto 1fr auto;
            padding: 15px;
            position: relative;
            z-index: 2;
            gap: 15px;
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .header-compact {
            display: grid;
            grid-template-columns: 250px 1fr 180px;
            align-items: center;
            gap: 15px;
            background: var(--gradiente-panel);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid var(--borde-color);
        }
        .main-area {
            display: grid;
            grid-template-columns: 220px 1fr 250px;
            gap: 15px;
            height: 100%;
            overflow: hidden;
            transition: opacity 0.5s ease;
        }
        .control-bottom {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 25px;
        }
        .logo-compact { height: 50px; object-fit: contain; }
        .title-compact { font-family: 'Playfair Display', serif; font-size: 1.8em; color: var(--color-oro); text-shadow: 2px 2px 4px rgba(0,0,0,0.5); text-align: center; }
        .timer-compact { font-size: 1.5em; font-weight: 800; color: var(--color-oro); background: rgba(255,215,0,0.1); padding: 8px; border-radius: 8px; border: 2px solid var(--borde-color); text-align: center; }
        .bombos-section, .info-panel { display: flex; flex-direction: column; gap: 10px; transition: opacity 0.5s, transform 0.5s; }
        .bombo-compact, .stats-compact, .log-compact { background: var(--gradiente-panel); backdrop-filter: blur(12px); border-radius: 10px; padding: 12px; border: 2px solid var(--borde-color); }
        .log-compact { flex-grow: 1; overflow-y: auto; }
        .bombo-title-compact, .stats-title, .log-title { font-family: 'Playfair Display', serif; font-size: 1.1em; color: var(--color-oro); text-align: center; margin-bottom: 8px; }
        .teams-compact { display: flex; flex-direction: column; gap: 6px; }
        .team-compact { background: linear-gradient(135deg, rgba(255,255,255,0.08) 0%, rgba(255,255,255,0.04) 100%); border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; padding: 8px; display: flex; align-items: center; gap: 8px; transition: all 0.3s ease; }
        .team-logo-compact { width: 25px; height: 25px; object-fit: contain; }
        .team-name-compact { flex: 1; font-size: 0.75em; font-weight: 600; }
        .grupos-center { display: grid; grid-template-rows: 1fr 1fr; gap: 15px; transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1); }
        .grupo-large { background: var(--gradiente-panel); backdrop-filter: blur(12px); border-radius: 15px; padding: 20px; border: 3px solid var(--borde-color); transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1); }
        .grupo-title-large { font-family: 'Playfair Display', serif; font-size: 2em; color: var(--color-oro); text-align: center; margin-bottom: 15px; }
        .grupo-slots-large { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; height: calc(100% - 50px); }
        .slot-large { background: rgba(0,0,0,0.2); border: 2px dashed var(--borde-color); border-radius: 10px; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease; position: relative; }
        .slot-large.filled { border-style: solid; border-color: var(--color-oro); background: rgba(255,215,0,0.1); }
        .team-in-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center; /* <-- CAMBIO CLAVE: Centrado Vertical */
            text-align: center;
            gap: 8px; /* Aumentado para más espacio */
            width: 100%;
            height: 100%;
            padding: 5px;
            opacity: 0;
            animation: fadeIn 0.5s forwards;
        }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }
        .team-logo-large { width: 50px; height: 50px; object-fit: contain; }
        .team-name-large { font-size: 0.75em; font-weight: 600; }
        .stat-item { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .stat-value { color: var(--color-oro); font-weight: 700; }
        .log-entry-compact { font-size: 0.7em; padding: 3px 0; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .button-main, .button-secondary { border: none; padding: 12px 35px; font-size: 1.2em; font-weight: 800; border-radius: 50px; cursor: pointer; transition: all 0.3s ease; text-transform: uppercase; letter-spacing: 1px; }
        .button-main { background: linear-gradient(135deg, var(--color-oro) 0%, #ffed4a 100%); color: var(--color-fondo); box-shadow: 0 6px 20px rgba(255,215,0,0.4); }
        .button-main:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(255,215,0,0.6); }
        .button-main:disabled { background: #64748b; color: #cbd5e1; cursor: not-allowed; transform: none; box-shadow: none; }
        .button-secondary { background: rgba(255,255,255,0.1); color: #fff; }
        .status-main { font-size: 1.1em; font-weight: 600; color: var(--color-oro); min-width: 250px; text-align: center; }
        .moving-team { position: fixed; z-index: 1000; transition: all 0.8s cubic-bezier(0.5, 0, 0.5, 1); filter: drop-shadow(0 8px 20px rgba(255,215,0,0.6)); }
        .selected-final { animation: final-selection 1s ease-in-out; border-color: var(--color-oro) !important; box-shadow: 0 0 30px rgba(255,215,0,1); transform: scale(1.05); }
        @keyframes final-selection { 50% { box-shadow: 0 0 40px rgba(255,215,0,1); transform: scale(1.1); } }
        .pre-select-glow { border-color: var(--color-oro) !important; box-shadow: 0 0 15px rgba(255,215,0,0.7); }
        .normativa-popup { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(10px); display: flex; align-items: center; justify-content: center; z-index: 3000; opacity: 0; transition: opacity 0.3s; pointer-events: none; }
        .normativa-popup.visible { opacity: 1; pointer-events: all; }
        .popup-content { background: var(--gradiente-panel); border-radius: 20px; padding: 40px; border: 3px solid var(--borde-color); max-width: 600px; text-align: center; transform: scale(0.9); transition: transform 0.3s; }
        .normativa-popup.visible .popup-content { transform: scale(1); }
        .popup-title { font-family: 'Playfair Display', serif; font-size: 2em; color: var(--color-oro); margin-bottom: 20px; }
        .popup-text { font-size: 1.1em; line-height: 1.6; margin-bottom: 30px; white-space: pre-wrap; }
        .popup-button { background: var(--color-oro); color: var(--color-fondo); padding: 15px 30px; font-size: 1.1em; font-weight: 700; border-radius: 25px; }
        .logo-placeholder { background: #475569; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 0.8em; color: #f1f5f9; }
        .logo-placeholder.compact { width: 25px; height: 25px; }
        .logo-placeholder.large { width: 50px; height: 50px; }
        .container.final-view .main-area { grid-template-columns: 1fr; }
        .container.final-view .bombos-section, .container.final-view .info-panel { opacity: 0; pointer-events: none; transform: scale(0.9); }
        .container.final-view .grupos-center { grid-template-rows: 1fr 1fr; grid-template-columns: 1fr; max-width: 800px; margin: 0 auto; align-items: center; }
        .container.final-view .grupo-large { transform: scale(1.0); }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: rgba(255,255,255,0.1); }
        ::-webkit-scrollbar-thumb { background: rgba(255,215,0,0.5); border-radius: 3px; }
    </style>
</head>
<body>
    <div class="container" id="main-container">
        <header class="header-compact">
            <img src="https://liga.badminton.es/wp-content/uploads/2024/01/AF_Iberdrola_Badminton_RGB_POS_H.png" alt="Logo TOP10 IBERDROLA" class="logo-compact" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
            <div class="logo-placeholder compact" style="display: none; width: 200px; height: 50px;">TOP10</div>
            <h1 class="title-compact">Sorteo Oficial 2025/2026</h1>
            <div class="timer-compact" id="timer">00:00</div>
        </header>

        <main class="main-area">
            <section class="bombos-section">
                <div class="bombo-compact" id="bombo-heads"><h2 class="bombo-title-compact">Cabezas de Serie</h2><div class="teams-compact" id="heads-teams"></div></div>
                <div class="bombo-compact" id="bombo-1"><h2 class="bombo-title-compact">Bombo 1</h2><div class="teams-compact" id="pot1-teams"></div></div>
                <div class="bombo-compact" id="bombo-2"><h2 class="bombo-title-compact">Bombo 2</h2><div class="teams-compact" id="pot2-teams"></div></div>
            </section>

            <section class="grupos-center">
                <div class="grupo-large"><h2 class="grupo-title-large">GRUPO A</h2><div class="grupo-slots-large" id="grupo-a-slots"></div></div>
                <div class="grupo-large"><h2 class="grupo-title-large">GRUPO B</h2><div class="grupo-slots-large" id="grupo-b-slots"></div></div>
            </section>

            <section class="info-panel">
                <div class="stats-compact">
                    <h2 class="stats-title">Estadísticas</h2>
                    <div class="stat-item"><span class="stat-label">Fase:</span><span class="stat-value" id="current-phase">Preparación</span></div>
                    <div class="stat-item"><span class="stat-label">Probabilidad:</span><span class="stat-value" id="probability">N/A</span></div>
                    <div class="stat-item"><span class="stat-label">Progreso:</span><span class="stat-value" id="progress">0 / 8</span></div>
                </div>
                <div class="log-compact"><h2 class="log-title">Registro del Sorteo</h2><div id="log-entries" aria-live="polite"></div></div>
            </section>
        </main>

        <footer class="control-bottom">
            <button class="button-main" id="main-button">Iniciar Sorteo</button>
            <div class="status-main" id="status-text" aria-live="polite">Listo para comenzar</div>
        </footer>
    </div>

    <div class="normativa-popup" id="normativa-popup">
        <div class="popup-content">
            <h2 class="popup-title" id="popup-title"></h2>
            <p class="popup-text" id="popup-text"></p>
        </div>
    </div>

    <script>
        // --- CONFIGURACIÓN Y DATOS ---
        const AppConfig = {
            teams: [
                { name: "Recreativo IES La Orden", position: "Campeón", logo: "https://liga.badminton.es/wp-content/uploads/2022/09/IES-La-Orden.png", type: "head" },
                { name: "Puertas Padilla Cartagena", position: "Subcampeón", logo: "https://liga.badminton.es/wp-content/uploads/2022/12/Logo-Puertas-Padilla-Cartagena.png", type: "head" },
                { name: "Oviedo", position: "3º Clasificado", logo: "https://liga.badminton.es/wp-content/uploads/2022/09/Logo-cbo-formato-vertical.ai_.png", type: "pot1" },
                { name: "Rinconada - Sevilla", position: "4º Clasificado", logo: "https://liga.badminton.es/wp-content/uploads/2022/12/Rinconada.png", type: "pot1" },
                { name: "Ravachol Pontevedra", position: "5º Clasificado", logo: "https://liga.badminton.es/wp-content/uploads/2022/09/LOGO-HORIZONTAL.png", type: "pot2" },
                { name: "UD Ibiza - Bádminton Pitius", position: "6º Clasificado", logo: "https://liga.badminton.es/wp-content/uploads/2022/12/Shield_of_UD_Ibiza.png", type: "pot2" },
                { name: "Alicante Intercity", position: "7º Clasificado", logo: "https://liga.badminton.es/wp-content/uploads/2022/12/Diseno-sin-titulo-46.png", type: "pot2" },
                { name: "San Fernando Valencia", position: "8º Clasificado", logo: "https://liga.badminton.es/wp-content/uploads/2022/12/Diseno-sin-titulo-30.png", type: "pot2" },
                { name: "Astures", position: "Ascendido", logo: "https://liga.badminton.es/wp-content/uploads/2022/12/ASTURES.png", type: "pot2" },
                { name: "Huesca La Magia", position: "Ascendido", logo: "https://liga.badminton.es/wp-content/uploads/2022/12/images-2-300x104.png", type: "pot2" }
            ],
            normativa: [
                { title: "Normativa: Cabezas de Serie", text: "El Campeón se asigna al Grupo A.\nEl Subcampeón se asigna al Grupo B." },
                { title: "Normativa: Bombo 1", text: "El 3º y 4º clasificado deben ir a grupos separados.\nSe sorteará aleatoriamente cuál va al Grupo A y el otro irá por defecto al Grupo B." },
                { title: "Normativa: Bombo 2", text: "Los 6 equipos restantes se sortearán de forma aleatoria para rellenar las plazas libres de cada grupo." }
            ],
            delays: { step: 800, move: 800, select: 1000, preSelect: 3000 }
        };

        // --- ESTADO DE LA APLICACIÓN ---
        const AppState = {
            isDrawing: false,
            timerInterval: null,
            assignedTeams: new Set(),
            dom: {}
        };

        // --- MÓDULO DE UI ---
        const UI = {
            cacheDOM() {
                const D = id => document.getElementById(id);
                AppState.dom = {
                    mainContainer: D('main-container'), mainButton: D('main-button'),
                    timer: D('timer'), statusText: D('status-text'), headsTeams: D('heads-teams'),
                    pot1Teams: D('pot1-teams'), pot2Teams: D('pot2-teams'), groupA: D('grupo-a-slots'),
                    groupB: D('grupo-b-slots'), logEntries: D('log-entries'), popup: D('normativa-popup'),
                    popupTitle: D('popup-title'), popupText: D('popup-text'),
                    currentPhase: D('current-phase'), probability: D('probability'), progress: D('progress'),
                };
            },
            createTeamCard(team) {
                const card = document.createElement('div');
                card.className = 'team-compact';
                card.dataset.teamName = team.name;
                card.innerHTML = `<img src="${team.logo}" alt="" class="team-logo-compact" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"><div class="logo-placeholder compact" style="display:none;">${team.name.slice(0,3)}</div><div class="team-name-compact">${team.name}</div>`;
                return card;
            },
            fillSlot(slot, team) {
                slot.innerHTML = `<div class="team-in-group"><img src="${team.logo}" alt="" class="team-logo-large" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"><div class="logo-placeholder large" style="display:none;">${team.name.slice(0,3)}</div><div class="team-name-large">${team.name}</div></div>`;
                slot.classList.add('filled');
            },
            log(message) {
                const entry = document.createElement('div');
                entry.className = 'log-entry-compact';
                entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
                if (AppState.dom.logEntries) {
                    AppState.dom.logEntries.prepend(entry);
                }
            },
            reset() {
                AppState.dom.mainContainer.classList.remove('final-view');
                ['headsTeams', 'pot1Teams', 'pot2Teams', 'groupA', 'groupB'].forEach(key => AppState.dom[key].innerHTML = '');
                
                AppConfig.teams.forEach(team => {
                    const card = this.createTeamCard(team);
                    if (team.type === 'head') AppState.dom.headsTeams.appendChild(card);
                    else if (team.type === 'pot1') AppState.dom.pot1Teams.appendChild(card);
                    else AppState.dom.pot2Teams.appendChild(card);
                });

                for (let i = 1; i <= 5; i++) {
                    AppState.dom.groupA.innerHTML += `<div class="slot-large"></div>`;
                    AppState.dom.groupB.innerHTML += `<div class="slot-large"></div>`;
                }
                
                AppState.dom.logEntries.innerHTML = '';
                AppState.dom.mainButton.disabled = false;
                AppState.dom.mainButton.textContent = 'Iniciar Sorteo';
                this.updateStatus('Listo para comenzar');
                this.updateStats('Preparación', 'N/A', 0);
            },
            updateStatus(text) { AppState.dom.statusText.textContent = text; },
            updateStats(phase, probability, drawnCount) {
                AppState.dom.currentPhase.textContent = phase;
                AppState.dom.probability.textContent = probability;
                AppState.dom.progress.textContent = `${drawnCount} / 8`;
            },
            showPopup(phaseIndex, duration = 3000) {
                return new Promise(resolve => {
                    const rule = AppConfig.normativa[phaseIndex];
                    AppState.dom.popupTitle.textContent = rule.title;
                    AppState.dom.popupText.textContent = rule.text;
                    AppState.dom.popup.classList.add('visible');
                    setTimeout(() => {
                        AppState.dom.popup.classList.remove('visible');
                        resolve();
                    }, duration);
                });
            },
            enterFinalView() {
                AppState.dom.mainContainer.classList.add('final-view');
                const newButton = AppState.dom.mainButton.cloneNode(true);
                newButton.textContent = "Volver";
                newButton.onclick = () => this.reset();
                AppState.dom.mainButton.replaceWith(newButton);
                AppState.dom.mainButton = newButton;
            }
        };

        // --- ANIMACIONES ---
        const Animations = {
            pause: (duration) => new Promise(resolve => setTimeout(resolve, duration)),
            move(card, targetSlot) {
                return new Promise(resolve => {
                    const startRect = card.getBoundingClientRect();
                    const endRect = targetSlot.getBoundingClientRect();
                    const movingCard = card.cloneNode(true);
                    movingCard.classList.add('moving-team');
                    Object.assign(movingCard.style, { left: `${startRect.left}px`, top: `${startRect.top}px`, width: `${startRect.width}px`, height: `${startRect.height}px` });
                    document.body.appendChild(movingCard);
                    card.style.opacity = '0.2';
                    
                    requestAnimationFrame(() => {
                        Object.assign(movingCard.style, { 
                            left: `${endRect.left}px`, top: `${endRect.top}px`, 
                            width: `${endRect.width}px`, height: `${endRect.height}px`,
                            padding: '0px'
                        });
                    });

                    setTimeout(() => {
                        const teamData = AppConfig.teams.find(t => t.name === card.dataset.teamName);
                        UI.fillSlot(targetSlot, teamData);
                        movingCard.remove();
                        card.remove();
                        resolve();
                    }, AppConfig.delays.move);
                });
            },
            async selectFromPot(potKey) {
                const potContainer = AppState.dom[potKey];
                const availableCards = [...potContainer.children].filter(c => c.style.opacity !== '0.2');
                if (availableCards.length === 0) return null;

                // Animación de pre-selección
                const preSelectDuration = AppConfig.delays.preSelect;
                const interval = 40; // Más rápido para efecto flicker
                let lastGlowedCard = null;
                const startTime = Date.now();

                while (Date.now() - startTime < preSelectDuration) {
                    if (lastGlowedCard) lastGlowedCard.classList.remove('pre-select-glow');
                    const randomCard = availableCards[Math.floor(Math.random() * availableCards.length)];
                    randomCard.classList.add('pre-select-glow');
                    lastGlowedCard = randomCard;
                    await this.pause(interval);
                }
                if (lastGlowedCard) lastGlowedCard.classList.remove('pre-select-glow');
                
                // Selección final
                const selectedCard = availableCards[Math.floor(Math.random() * availableCards.length)];
                selectedCard.classList.add('selected-final');
                await this.pause(AppConfig.delays.select);
                return selectedCard;
            }
        };

        // --- LÓGICA DEL SORTEO ---
        const DrawController = {
            async run() {
                if (AppState.isDrawing) return;
                AppState.isDrawing = true;
                
                this.prepare();
                await UI.showPopup(0);
                await this.phase1_Heads();
                
                await Animations.pause(2000); // Pausa adicional post cabezas de serie

                await UI.showPopup(1, 5000); // Popup 2 con 5 segundos
                await this.phase2_Pot1();

                await UI.showPopup(2);
                await this.phase3_Pot2();
                
                this.finish();
            },
            prepare() {
                UI.reset();
                AppState.assignedTeams.clear();
                AppState.isDrawing = true;
                AppState.dom.mainButton.disabled = true;
                const startTime = Date.now();
                AppState.timerInterval = setInterval(() => {
                    const elapsed = new Date(Date.now() - startTime);
                    AppState.dom.timer.textContent = elapsed.toISOString().substr(14, 5);
                }, 1000);
                UI.log("Sorteo iniciado.");
            },
            async assignTeam(teamName, targetSlot) {
                AppState.assignedTeams.add(teamName);
                const card = document.querySelector(`[data-team-name="${teamName}"]`);
                await Animations.move(card, targetSlot);
                UI.log(`${teamName} → ${targetSlot.parentElement.previousElementSibling.textContent.trim()}`);
                const drawnCount = AppState.assignedTeams.size - 2; // No contar cabezas de serie
                UI.updateStats(AppState.currentPhase, 'N/A', Math.max(0, drawnCount));
                await Animations.pause(AppConfig.delays.step); // Pausa para ritmo
            },
            async phase1_Heads() {
                AppState.currentPhase = "Cabezas de Serie";
                UI.updateStatus('Asignando Cabezas de Serie...');
                await this.assignTeam("Recreativo IES La Orden", AppState.dom.groupA.children[0]);
                await this.assignTeam("Puertas Padilla Cartagena", AppState.dom.groupB.children[0]);
            },
            async phase2_Pot1() {
                AppState.currentPhase = "Bombo 1";
                UI.updateStatus('Sorteando Bombo 1...');
                const selectedCard = await Animations.selectFromPot('pot1Teams');
                await this.assignTeam(selectedCard.dataset.teamName, AppState.dom.groupA.children[1]);
                
                const remainingCard = AppState.dom.pot1Teams.querySelector('.team-compact');
                if(remainingCard) await this.assignTeam(remainingCard.dataset.teamName, AppState.dom.groupB.children[1]);
            },
            async phase3_Pot2() {
                AppState.currentPhase = "Bombo 2";
                let groupASlot = 2, groupBSlot = 2;

                while(AppState.assignedTeams.size < AppConfig.teams.length) {
                    const pot2Teams = AppConfig.teams.filter(t => t.type === 'pot2');
                    const remainingInPot = pot2Teams.filter(team => !AppState.assignedTeams.has(team.name));
                    if (remainingInPot.length === 0) break;

                    const remainingCount = remainingInPot.length;
                    UI.updateStats(AppState.currentPhase, `${(100/remainingCount).toFixed(1)}%`, AppState.assignedTeams.size - 2);
                    UI.updateStatus(`Sorteando Bombo 2 (${remainingCount} restantes)`);

                    const selectedCard = await Animations.selectFromPot('pot2Teams');
                    if (!selectedCard || AppState.assignedTeams.has(selectedCard.dataset.teamName)) {
                        const realCard = AppState.dom.pot2Teams.querySelector('.team-compact:not([style*="opacity: 0.2"])');
                        if(realCard) await this.assignTeamToGroup(realCard, groupASlot, groupBSlot);
                    } else {
                       await this.assignTeamToGroup(selectedCard, groupASlot, groupBSlot);
                    }
                    if(groupASlot <= groupBSlot && groupASlot < 5) groupASlot++; else groupBSlot++;
                }
            },
            async assignTeamToGroup(card, slotA, slotB) {
                 if (slotA <= slotB && slotA < 5) {
                    await this.assignTeam(card.dataset.teamName, AppState.dom.groupA.children[slotA]);
                } else if (slotB < 5) {
                    await this.assignTeam(card.dataset.teamName, AppState.dom.groupB.children[slotB]);
                }
            },
            finish() {
                clearInterval(AppState.timerInterval);
                UI.updateStatus('Sorteo Finalizado');
                UI.updateStats('Finalizado', '100%', 8);
                UI.log("Sorteo completado.");
                setTimeout(() => UI.enterFinalView(), 1500);
                AppState.isDrawing = false;
            }
        };

        // --- INICIALIZACIÓN ---
        window.addEventListener('load', () => {
            UI.cacheDOM();
            UI.reset();
            AppState.dom.mainButton.addEventListener('click', () => DrawController.run());
        });
    </script>
</body>
</html>
